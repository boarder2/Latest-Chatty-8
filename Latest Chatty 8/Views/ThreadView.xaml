<common:LayoutAwarePage
    x:Name="pageRoot"
    x:Class="Latest_Chatty_8.Views.ThreadView"
    DataContext="{Binding DefaultViewModel, RelativeSource={RelativeSource Self}}"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Latest_Chatty_8.Views"
    xmlns:common="using:Latest_Chatty_8.Common"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:data="using:Latest_Chatty_8.Data"
    mc:Ignorable="d">

	<Page.Resources>
		<CollectionViewSource
			 x:Name="CommentsViewSource"
			 Source="{Binding Comments}"
			 d:Source="{Binding Comments, Source={d:DesignInstance Type=data:SampleCommentThread, IsDesignTimeCreatable=True}}"/>
	</Page.Resources>
	
	<Page.BottomAppBar>
		<AppBar x:Name="bottomBar">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0"  Orientation="Horizontal">
					<Button Style="{StaticResource RefreshAppBarButtonStyle}" Click="RefreshClicked"/>
					<Button Style="{StaticResource PinAppBarButtonStyle}" Click="PinClicked" Visibility="{Binding IsPinned, Converter={StaticResource NotBoolToVisConverter}}"/>
					<Button Style="{StaticResource UnPinAppBarButtonStyle}" Click="UnPinClicked" Visibility="{Binding IsPinned, Converter={StaticResource BoolToVisConverter}}"/>
				</StackPanel>
				<StackPanel Grid.Column="1"  Orientation="Horizontal" FlowDirection="RightToLeft">
					<Button Style="{StaticResource CommentAppBarButtonStyle}" Click="ReplyClicked" AutomationProperties.Name="Reply" />
				</StackPanel>
			</Grid>
		</AppBar>
	</Page.BottomAppBar>

	<Grid Style="{StaticResource LayoutRootStyle}" Margin="0, 6, 6, 6">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Back button and page title -->
		<Grid Margin="0,0,0,10" Grid.Row="0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>
			<Button Grid.Column="0" x:Name="backButton" Click="GoBack" IsEnabled="{Binding Frame.CanGoBack, ElementName=pageRoot}" Style="{StaticResource BackButtonStyle}" VerticalAlignment="Top" Margin="36,36,36,36"/>

			<ContentControl Grid.Column="1" Template="{StaticResource CommentWebView}" DataContext="{Binding ElementName=commentList, Path=SelectedItem}" Height="380"/>
		</Grid>

		<ListView
			x:Name="commentList"
			Grid.Row="1"
			Grid.Column="1"
			Margin="116, 0, 0, 0"
			IsSwipeEnabled="False"
			SelectionMode="Single"
			IsRightTapEnabled="False"
			ItemsSource="{Binding Source={StaticResource CommentsViewSource}}"
			ItemTemplate="{StaticResource ThreadedCommentListItem}"/>

		<ProgressBar x:Name="loadingBar" IsIndeterminate="True" VerticalAlignment="Top"/>

		<VisualStateManager.VisualStateGroups>

			<!-- Visual states reflect the application's view state -->
			<VisualStateGroup x:Name="ApplicationViewStates">
				<VisualState x:Name="FullScreenLandscape"/>
				<VisualState x:Name="Filled"/>

				<!-- The entire page respects the narrower 100-pixel margin convention for portrait -->
				<VisualState x:Name="FullScreenPortrait">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
							<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource PortraitBackButtonStyle}"/>
						</ObjectAnimationUsingKeyFrames>
					</Storyboard>
				</VisualState>

				<!-- The back button and title have different styles when snapped -->
				<VisualState x:Name="Snapped">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
							<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource SnappedBackButtonStyle}"/>
						</ObjectAnimationUsingKeyFrames>
					</Storyboard>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>
	</Grid>
</common:LayoutAwarePage>
