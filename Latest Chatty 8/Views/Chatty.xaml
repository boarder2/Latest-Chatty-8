<common:LayoutAwarePage
	x:Class="Latest_Chatty_8.Views.Chatty"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:common="using:Latest_Chatty_8.Common"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:data="using:Latest_Chatty_8.Data"
	xmlns:local="using:Latest_Chatty_8.Views"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	x:Name="pageRoot"
	DataContext="{Binding DefaultViewModel,
                                              RelativeSource={RelativeSource Self}}"
	mc:Ignorable="d">

	<Page.Resources>
		<CollectionViewSource
			x:Name="chattyCommentsViewSource"
			Source="{Binding ChattyComments}"
			d:Source="{Binding Comments,
		                                         Source={d:DesignInstance Type=data:SampleChattyComments,
		                                                                  IsDesignTimeCreatable=True}}" />

		<CollectionViewSource
			x:Name="CommentsViewSource"
			Source="{Binding ThreadComments}"
			d:Source="{Binding Comments,
		                                         Source={d:DesignInstance Type=data:SampleCommentThread,
		                                                                  IsDesignTimeCreatable=True}}" />
	</Page.Resources>

	<Page.BottomAppBar>
		<AppBar x:Name="bottomBar" DataContext="">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal">
					<Button Click="RefreshClicked" Style="{StaticResource RefreshAppBarButtonStyle}" />
					<StackPanel
						x:Name="pinSection"
						Orientation="Horizontal"
						Visibility="Collapsed">
						<Button
							Click="PinClicked"
							Style="{StaticResource PinAppBarButtonStyle}"
							Visibility="{Binding IsPinned,
						                             Converter={StaticResource NotBoolToVisConverter}}" />
						<Button
							Click="UnPinClicked"
							Style="{StaticResource UnPinAppBarButtonStyle}"
							Visibility="{Binding IsPinned,
						                             Converter={StaticResource BoolToVisConverter}}" />
					</StackPanel>
				</StackPanel>
				<StackPanel
					Grid.Column="1"
					FlowDirection="RightToLeft"
					Orientation="Horizontal">
					<Button
						x:Name="replyButton"
						AutomationProperties.Name="Reply"
						Click="ReplyClicked"
						Style="{StaticResource CommentAppBarButtonStyle}" />
				</StackPanel>
			</Grid>
		</AppBar>
	</Page.BottomAppBar>
	<!--
		This grid acts as a root panel for the page that defines two rows:
		* Row 0 contains the back button and page title
		* Row 1 contains the rest of the page layout
	-->
	<Grid Background="{StaticResource ApplicationPageBackgroundThemeBrush}">
		<Grid.RowDefinitions>
			<RowDefinition Height="140" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<!--  Back button and page title  -->
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>
			<Button
				x:Name="backButton"
				Click="GoBack"
				IsEnabled="{Binding Frame.CanGoBack,
			                            ElementName=pageRoot}"
				Style="{StaticResource BackButtonStyle}" />
			<TextBlock
				x:Name="pageTitle"
				Grid.Column="1"
				Style="{StaticResource PageHeaderTextStyle}"
				Text="chatty" />
		</Grid>

		<Grid x:Name="chattyCommentsSectionWide" Grid.Row="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="3*" />
			</Grid.ColumnDefinitions>
			<ListView
				x:Name="chattyCommentList"
				Grid.Row="1"
				Margin="6,0,0,0"
				IsSwipeEnabled="False"
				ItemContainerStyle="{StaticResource FillWidthItemView}"
				ItemTemplate="{StaticResource ChattyRootCommentItemTemplate}"
				ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
				SelectionMode="Single" />
			<Grid
				Grid.Row="0"
				Grid.RowSpan="2"
				Grid.Column="1"
				Margin="0, -140, 0, 0">
				<Grid.RowDefinitions>
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>
				<ContentControl
					x:Name="commentBrowser"
					Grid.Column="0"
					DataContext="{Binding ElementName=threadCommentList,
				                                      Path=SelectedItem}"
					Template="{StaticResource CommentWebView}" />
				<!--  <Rectangle Grid.Row="1" Fill="Black" Height="1" />  -->
				<ListView
					x:Name="threadCommentList"
					Grid.Row="2"
					Grid.Column="1"
					Margin="0,6,0,0"
					IsRightTapEnabled="False"
					IsSwipeEnabled="False"
					ItemTemplate="{StaticResource ThreadedCommentListItem}"
					ItemsSource="{Binding Source={StaticResource CommentsViewSource}}"
					SelectionMode="Single" />
			</Grid>
		</Grid>
		<ListView
			x:Name="chattyCommentListSnapped"
			Grid.Row="1"
			Margin="6,0,0,0"
			IsItemClickEnabled="True"
			IsSwipeEnabled="False"
			ItemClick="SnappedCommentListItemClicked"
			ItemContainerStyle="{StaticResource FillWidthItemView}"
			ItemTemplate="{StaticResource ChattyRootCommentItemTemplate}"
			ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
			SelectionMode="None"
			Visibility="Collapsed" />
		<ProgressBar
			x:Name="loadingBar"
			VerticalAlignment="Top"
			IsIndeterminate="False"
			Visibility="Collapsed" />

		<VisualStateManager.VisualStateGroups>

			<!--  Visual states reflect the application's view state  -->
			<VisualStateGroup x:Name="ApplicationViewStates">
				<VisualState x:Name="FullScreenLandscape" />
				<VisualState x:Name="Filled" />

				<!--  The entire page respects the narrower 100-pixel margin convention for portrait  -->
				<VisualState x:Name="FullScreenPortrait">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
							<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource PortraitBackButtonStyle}" />
						</ObjectAnimationUsingKeyFrames>
					</Storyboard>
				</VisualState>

				<!--  The back button and title have different styles when snapped  -->
				<VisualState x:Name="Snapped">
					<Storyboard>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
							<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource SnappedBackButtonStyle}" />
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="pageTitle" Storyboard.TargetProperty="Style">
							<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource SnappedPageHeaderTextStyle}" />
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentsSectionWide" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="threadCommentList" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentList" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentListSnapped" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Visible</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="replyButton" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="pinSection" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
					</Storyboard>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>
	</Grid>
</common:LayoutAwarePage>
