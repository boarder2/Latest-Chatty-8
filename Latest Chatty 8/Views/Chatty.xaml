<common:LayoutAwarePage
   x:Name="pageRoot"
   x:Class="Latest_Chatty_8.Views.Chatty"
   DataContext="{Binding DefaultViewModel, RelativeSource={RelativeSource Self}}"
   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:local="using:Latest_Chatty_8.Views"
   xmlns:common="using:Latest_Chatty_8.Common"
   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
   xmlns:data="using:Latest_Chatty_8.Data"
   mc:Ignorable="d">

   <Page.Resources>
      <CollectionViewSource
         x:Name="chattyCommentsViewSource"
         Source="{Binding ChattyComments}"
         d:Source="{Binding Comments, Source={d:DesignInstance Type=data:SampleChattyComments, IsDesignTimeCreatable=True}}"/>

      <CollectionViewSource
         x:Name="CommentsViewSource"
         Source="{Binding ThreadComments}"
         d:Source="{Binding Comments, Source={d:DesignInstance Type=data:SampleCommentThread, IsDesignTimeCreatable=True}}"/>
   </Page.Resources>

	<Page.BottomAppBar>
		<AppBar x:Name="bottomBar">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0"  Orientation="Horizontal">
					<Button Style="{StaticResource RefreshAppBarButtonStyle}" Click="RefreshClicked"/>
					<StackPanel Orientation="Horizontal">
						<Button Style="{StaticResource PinAppBarButtonStyle}" Click="PinClicked" Visibility="{Binding ElementName=chattyCommentList, Path=SelectedItem.IsPinned, Converter={StaticResource NotBoolToVisConverter}}"/>
						<Button Style="{StaticResource UnPinAppBarButtonStyle}" Click="UnPinClicked" Visibility="{Binding ElementName=chattyCommentList, Path=SelectedItem.IsPinned, Converter={StaticResource BoolToVisConverter}}"/>
					</StackPanel>
				</StackPanel>
				<StackPanel Grid.Column="1"  Orientation="Horizontal" FlowDirection="RightToLeft">
					<Button Style="{StaticResource CommentAppBarButtonStyle}" Click="ReplyClicked" AutomationProperties.Name="Reply" />
				</StackPanel>
			</Grid>
		</AppBar>
	</Page.BottomAppBar>
	<!--
       This grid acts as a root panel for the page that defines two rows:
       * Row 0 contains the back button and page title
       * Row 1 contains the rest of the page layout
   -->
	<Grid Background="{StaticResource ApplicationPageBackgroundThemeBrush}">
      <Grid.RowDefinitions>
         <RowDefinition Height="140"/>
         <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <!-- Back button and page title -->
      <Grid>
         <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
         </Grid.ColumnDefinitions>
         <Button x:Name="backButton" Click="GoBack" IsEnabled="{Binding Frame.CanGoBack, ElementName=pageRoot}" Style="{StaticResource BackButtonStyle}"/>
         <TextBlock x:Name="pageTitle" Grid.Column="1" Style="{StaticResource PageHeaderTextStyle}" Text="chatty" />
      </Grid>

      <Grid Grid.Row="1" x:Name="chattyCommentsSectionWide" >
         <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
         </Grid.RowDefinitions>
         <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="3*" />
         </Grid.ColumnDefinitions>
         <ListView
            x:Name="chattyCommentList"
            Grid.Row="1"
            IsSwipeEnabled="False"
            SelectionMode="Single"
            Margin="6,0,0,0"
            ItemContainerStyle="{StaticResource FillWidthItemView}"
            ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
            ItemTemplate="{StaticResource ChattyRootCommentItemTemplate}" />
         <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" Margin="0, -140, 0, 0">
            <Grid.RowDefinitions>
               <RowDefinition Height="*"/>
					<RowDefinition Height="Auto" />
               <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <ContentControl Grid.Column="0" x:Name="commentBrowser" Template="{StaticResource CommentWebView}" DataContext="{Binding ElementName=threadCommentList, Path=SelectedItem}" />
				<!--<Rectangle Grid.Row="1" Fill="Black" Height="1" />-->
            <ListView
               x:Name="threadCommentList"
               Grid.Row="2"
               Grid.Column="1"
					Margin="0,6,0,0"
               IsSwipeEnabled="False"
               SelectionMode="Single"
               IsRightTapEnabled="False"
               ItemsSource="{Binding Source={StaticResource CommentsViewSource}}"
               ItemTemplate="{StaticResource ThreadedCommentListItem}"/>
         </Grid>
      </Grid>
      <ListView
         x:Name="chattyCommentListSnapped"
         Grid.Row="1"
         IsSwipeEnabled="False"
         IsItemClickEnabled="True"
         SelectionMode="None"
         Margin="6,0,0,0"
         ItemContainerStyle="{StaticResource FillWidthItemView}"
         ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
         ItemTemplate="{StaticResource ChattyRootCommentItemTemplate}" 
         ItemClick="SnappedCommentListItemClicked"
         Visibility="Collapsed"/>
      <ProgressBar x:Name="loadingBar" IsIndeterminate="False" VerticalAlignment="Top" Visibility="Collapsed"/>

      <VisualStateManager.VisualStateGroups>

         <!-- Visual states reflect the application's view state -->
         <VisualStateGroup x:Name="ApplicationViewStates">
            <VisualState x:Name="FullScreenLandscape"/>
            <VisualState x:Name="Filled"/>

            <!-- The entire page respects the narrower 100-pixel margin convention for portrait -->
            <VisualState x:Name="FullScreenPortrait">
               <Storyboard>
                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
                     <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource PortraitBackButtonStyle}"/>
                  </ObjectAnimationUsingKeyFrames>
               </Storyboard>
            </VisualState>

            <!-- The back button and title have different styles when snapped -->
            <VisualState x:Name="Snapped">
               <Storyboard>
                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="backButton" Storyboard.TargetProperty="Style">
                     <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource SnappedBackButtonStyle}"/>
                  </ObjectAnimationUsingKeyFrames>
                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="pageTitle" Storyboard.TargetProperty="Style">
                     <DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource SnappedPageHeaderTextStyle}"/>
                  </ObjectAnimationUsingKeyFrames>
                  <ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentsSectionWide" Storyboard.TargetProperty="Visibility">
                     <DiscreteObjectKeyFrame KeyTime="0">
                        <DiscreteObjectKeyFrame.Value>
                           <Visibility>Collapsed</Visibility>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrame>
                  </ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="threadCommentList" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentList" Storyboard.TargetProperty="Visibility">
							<DiscreteObjectKeyFrame KeyTime="0">
								<DiscreteObjectKeyFrame.Value>
									<Visibility>Collapsed</Visibility>
								</DiscreteObjectKeyFrame.Value>
							</DiscreteObjectKeyFrame>
						</ObjectAnimationUsingKeyFrames>
						<ObjectAnimationUsingKeyFrames Storyboard.TargetName="chattyCommentListSnapped" Storyboard.TargetProperty="Visibility">
                     <DiscreteObjectKeyFrame KeyTime="0">
                        <DiscreteObjectKeyFrame.Value>
                           <Visibility>Visible</Visibility>
                        </DiscreteObjectKeyFrame.Value>
                     </DiscreteObjectKeyFrame>
                  </ObjectAnimationUsingKeyFrames>
               </Storyboard>
            </VisualState>
         </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>
   </Grid>
</common:LayoutAwarePage>
