<Page x:Class="Latest_Chatty_8.Views.Chatty"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:common="using:Latest_Chatty_8.Shared"
      xmlns:controls="using:Latest_Chatty_8.Controls"
      xmlns:core="using:Latest_Chatty_8"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="using:Latest_Chatty_8.Controls"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      x:Name="pageRoot"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      mc:Ignorable="d">
	<Page.Resources>
		<ResourceDictionary>
			<core:CoreServices x:Key="CoreServices" />
			<CollectionViewSource x:Name="chattyCommentsViewSource" Source="{Binding CommentThreads}" />
		</ResourceDictionary>
	</Page.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<Grid Grid.Row="0" Background="#ED2300">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>
			<TextBlock Grid.Column="0" VerticalAlignment="Center" FontSize="22">Chatty</TextBlock>
			<Grid Grid.Column="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
					<ToggleButton x:Name="newRootPostButton"
						              AutomationProperties.HelpText="New Root Post"
						              Style="{StaticResource CommentInlineButtonStyle}" />
					<ComboBox x:Name="filterCombo"
						          Margin="12,0,0,0"
						          SelectedIndex="0"
						          SelectionChanged="FilterChanged">
						<ComboBox.Items>
							<ComboBoxItem>all</ComboBoxItem>
							<ComboBoxItem>participated</ComboBoxItem>
							<ComboBoxItem>has replies</ComboBoxItem>
							<ComboBoxItem>new</ComboBoxItem>
						</ComboBox.Items>
					</ComboBox>
				</StackPanel>
				<StackPanel x:Name="chattyAppBar"
					            Grid.Column="1"
					            HorizontalAlignment="Stretch"
					            FlowDirection="RightToLeft"
					            Orientation="Horizontal">
					<Button x:Name="sortThreadsButton"
						        AutomationProperties.HelpText="Sort Threads"
						        Click="ReSortClicked"
						        IsEnabled="{Binding Source={StaticResource CoreServices},
						                            Path=Instance.UnsortedChattyPosts}"
						        Style="{StaticResource SortInlineButtonStyle}" />
					<Button AutomationProperties.HelpText="Mark All Read"
						        Click="MarkAllRead"
						        Style="{StaticResource ReadInlineButtonStyle}" />
				</StackPanel>
			</Grid>
		</Grid>
		<Grid x:Name="chattyCommentsSectionWide" Grid.Row="1">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="1.5*" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="2*" />
			</Grid.RowDefinitions>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="Auto" />
			</Grid.ColumnDefinitions>
            <local:PostContol Grid.Row="1"
			                  Grid.RowSpan="3"
			                  Grid.Column="2"
			                  Visibility="{Binding ElementName=newRootPostButton,
			                                       Path=IsChecked,
			                                       Converter={StaticResource BoolToVisConverter},
			                                       Mode=TwoWay}" />
            <Grid x:Name="selectedThreadView"
                  Grid.Row="1"
			                           Grid.RowSpan="3"
			                           Grid.Column="2"
			                           Margin="0, 0, 0, 0"
			                           DataContext="{Binding SelectedThread}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid Grid.Row="0"
		      Background="#FF0044"
		      Visibility="{Binding IsExpired,
		                           Converter={StaticResource BoolToVisConverter}}">
                    <TextBlock x:Name="expiredNotifier"
			           Margin="12,0,12,0"
			           HorizontalAlignment="Stretch"
			           FontSize="20"
			           Foreground="White"
			           Text="Expired" />
                </Grid>

                <ListView x:Name="commentList"
		          Grid.Row="1"
		          IsRightTapEnabled="False"
		          IsSwipeEnabled="False"
		          ItemContainerStyle="{StaticResource ThreadCommentListViewItemStyle}"
		          ItemsSource="{Binding Comments}"
		          SelectionChanged="SelectedItemChanged"
		          SelectionMode="Single">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid x:Name="container">
                                <Grid x:Name="preview">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Rectangle Grid.Column="0" Width="{Binding Depth, Converter={StaticResource IndentConverter}}" />
                                    <Grid x:Name="sizeGrid"
							      Grid.Column="1"
							      VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="5" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="26" />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Grid.Column="0"
								           Margin="0,4,0,4"
								           Fill="{Binding AccentColor}" />
                                        <TextBlock x:Name="content"
								           Grid.Column="1"
								           Margin="2,0,0,0"
								           HorizontalAlignment="Left"
								           VerticalAlignment="Center"
								           Foreground="{Binding IsNew,
								                                Converter={StaticResource NewReplyConverter}}"
								           Text="{Binding Preview}"
								           TextWrapping="NoWrap" />
                                        <TextBlock Grid.Column="2"
								           Margin="6,0,0,0"
								           HorizontalAlignment="Right"
								           VerticalAlignment="Center"
								           Foreground="#ffba00"
								           Text="{Binding Author}"
								           Visibility="{Binding Source={StaticResource CoreServices},
								                                Path=Instance.ShowAuthor,
								                                Converter={StaticResource BoolToVisConverter}}" />
                                        <StackPanel Grid.Column="3"
								            VerticalAlignment="Center"
								            Orientation="Horizontal">
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#FF8800"
									           Visibility="{Binding LolCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#0099CC"
									           Visibility="{Binding InfCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#FF0000"
									           Visibility="{Binding UnfCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#77BB22"
									           Visibility="{Binding TagCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#C000C0"
									           Visibility="{Binding WtfCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                            <Rectangle Width="3"
									           Height="10"
									           Margin="1"
									           Fill="#00BB00"
									           Visibility="{Binding UghCount,
									                                Converter={StaticResource GreaterThanZeroVisibilityConverter}}" />
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                                <Grid x:Name="commentSection" Visibility="Collapsed">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="5" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <TextBlock x:Name="author"
							           Grid.Row="0"
							           HorizontalAlignment="Left"
							           FontSize="20"
							           Foreground="#ffba00"
							           Text="{Binding Author}" />

                                    <TextBlock x:Name="date"
							           Grid.Row="0"
							           HorizontalAlignment="Right"
							           FontSize="20"
							           Foreground="#888888"
							           Text="{Binding DateText}" />
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Grid.Column="0" Width="{Binding Depth, Converter={StaticResource IndentConverter}}" />
                                        <Rectangle Grid.Column="1" Fill="{Binding Category, Converter={StaticResource CategoryConverter}}" />
                                    </Grid>
                                    <WebView x:Name="bodyWebView"
							         Grid.Row="2"
							         Width="Auto"
							         Height="Auto"
							         HorizontalAlignment="Stretch"
							         IsTapEnabled="True" />
                                    <Grid Grid.Row="3" Background="#212121">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0"
								            HorizontalAlignment="Left"
								            VerticalAlignment="Bottom"
								            Orientation="Horizontal">
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding LolCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">
                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#FF8800"
										           Text="{Binding LolCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#FF8800">lols</TextBlock>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding InfCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">
                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#0099CC"
										           Text="{Binding InfCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#0099CC">infs</TextBlock>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding UnfCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">
                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#FF0000"
										           Text="{Binding UnfCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#FF0000">unfs</TextBlock>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding TagCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">
                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#77BB22"
										           Text="{Binding TagCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#77BB22">tags</TextBlock>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding WtfCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">
                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#C000C0"
										           Text="{Binding WtfCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#C000C0">wtfs</TextBlock>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding UghCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}}">

                                                <TextBlock Margin="0,0,4,0"
										           Foreground="#00BB00"
										           Text="{Binding UghCount}" />
                                                <TextBlock Margin="0,0,6,0" Foreground="#00BB00">ughs</TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1"
								            HorizontalAlignment="Right"
								            FlowDirection="RightToLeft"
								            Orientation="Horizontal">
                                            <ToggleButton x:Name="showReply"
									              AutomationProperties.HelpText="New Root Post"
									              IsChecked="False"
									              Style="{StaticResource CommentInlineButtonStyle}" />
                                            <Button x:Name="tagButton" Style="{StaticResource TagInlineButtonStyle}">
                                                <Button.Flyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem Click="lolPostClicked">lol</MenuFlyoutItem>
                                                        <MenuFlyoutItem Click="lolPostClicked">inf</MenuFlyoutItem>
                                                        <MenuFlyoutItem Click="lolPostClicked">unf</MenuFlyoutItem>
                                                        <MenuFlyoutItem Click="lolPostClicked">tag</MenuFlyoutItem>
                                                    </MenuFlyout>
                                                </Button.Flyout>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                    <controls:PostContol x:Name="replyArea"
							                     Grid.Row="4"
							                     DataContext="{Binding}"
							                     Visibility="{Binding ElementName=showReply,
							                                          Path=IsChecked,
							                                          Converter={StaticResource BoolToVisConverter},
							                                          Mode=TwoWay}" />
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
            <!--
				Visibility="{Binding ElementName=newRootPostButton,
				Path=IsChecked,
				Converter={StaticResource NotBoolToVisConverter}}" />
			-->
			<!--  Visibility="{Binding SelectedThread, Converter={StaticResource NullToVisibilityConverter}}"/> :TODO: Figure out visibility converter.  -->
			<Border x:Name="divider"
			        Grid.Row="0"
			        Grid.RowSpan="4"
			        Grid.Column="3"
			        Width="7"
			        Padding="3">
				<Rectangle Opacity=".1"
				           Stroke="DarkGray"
				           StrokeThickness="1" />
			</Border>
			<Grid x:Name="chattyListGroup"
			      Grid.Row="1"
			      Grid.RowSpan="4"
			      Grid.Column="4"
			      MinWidth="320">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>
				
				<ProgressBar x:Name="fullRefreshProgress"
				             Grid.Row="1"
				             VerticalAlignment="Top"
				             IsIndeterminate="True"
				             Visibility="{Binding Path=IsFullUpdateHappening,
				                                  Converter={StaticResource BoolToVisConverter}}" />
				<ListView x:Name="chattyCommentList"
				                                 Grid.Row="1"
				                                 Margin="6,0,0,0"
				                                 ItemTemplate="{StaticResource ChattyCommentThreadItemTemplate}"
				                                 ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
				                                 SelectedValue="{Binding SelectedThread,
				                                                         Mode=TwoWay}"
				                                 VirtualizingStackPanel.VirtualizationMode="Recycling" />
				<ListView Grid.Row="1">
					<ListView.Items>
						<ListViewItem>Item 1</ListViewItem>
						<ListViewItem>Item 2</ListViewItem>
						<ListViewItem>Item 3</ListViewItem>
						<ListViewItem>Item 4</ListViewItem>
					</ListView.Items>
				</ListView>
				<TextBlock x:Name="lastUpdateTime"
				           Grid.Row="3"
				           Margin="6,6,0,6"
				           Style="{StaticResource BaselineTextStyle}"
				           Text="{Binding UpdateStatus}" />
			</Grid>
		</Grid>
	</Grid>

</Page>
