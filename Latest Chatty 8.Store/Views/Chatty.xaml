<views:ShellView x:Class="Latest_Chatty_8.Views.Chatty"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:common="using:Latest_Chatty_8.Shared"
                 xmlns:controls="using:Latest_Chatty_8.Controls"
                 xmlns:core="using:Latest_Chatty_8"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:local="using:Latest_Chatty_8.Controls"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:views="using:Latest_Chatty_8.Views"
                 x:Name="pageRoot"
                 DataContext="{Binding RelativeSource={RelativeSource Self}}"
                 mc:Ignorable="d">
	<Page.Resources>
		<ResourceDictionary>
			<core:CoreServices x:Key="CoreServices" />
			<CollectionViewSource x:Name="chattyCommentsViewSource" Source="{Binding CommentThreads}" />
		</ResourceDictionary>
	</Page.Resources>
	<Grid>
		<Grid x:Name="chattyCommentsSectionWide">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="1.5*" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="2*" />
			</Grid.RowDefinitions>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="Auto" />
			</Grid.ColumnDefinitions>
			<local:PostContol Grid.Row="1"
			                  Grid.RowSpan="3"
			                  Grid.Column="2"
			                  Visibility="{Binding ElementName=newRootPostButton,
			                                       Path=IsChecked,
			                                       Converter={StaticResource BoolToVisConverter},
			                                       Mode=TwoWay}" />
			<Grid x:Name="selectedThreadView"
			      Grid.Row="1"
			      Grid.RowSpan="3"
			      Grid.Column="2"
			      Margin="0, 0, 0, 0"
			      DataContext="{Binding SelectedThread}">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>
				<Grid Grid.Row="0"
				      Background="#FF0044"
				      Visibility="{Binding IsExpired,
				                           Converter={StaticResource BoolToVisConverter}}">
					<TextBlock x:Name="expiredNotifier"
					           Margin="12,0,12,0"
					           HorizontalAlignment="Stretch"
					           FontSize="20"
					           Foreground="White"
					           Text="Expired" />
				</Grid>

				<ListView x:Name="commentList"
				          Grid.Row="1"
				          IsRightTapEnabled="False"
				          IsSwipeEnabled="False"
				          ItemContainerStyle="{StaticResource ThreadCommentListViewItemStyle}"
				          ItemTemplate="{StaticResource SinglePostWithPreview}"
				          ItemsSource="{Binding Comments}"
				          SelectionChanged="SelectedItemChanged"
				          SelectionMode="Single"
				          Visibility="{Binding ElementName=newRootPostButton,
				                               Path=IsChecked,
				                               Converter={StaticResource NotBoolToVisConverter}}" />
			</Grid>
			<!--
				Visibility="{Binding ElementName=newRootPostButton,
				Path=IsChecked,
				Converter={StaticResource NotBoolToVisConverter}}" />
			-->
			<!--  Visibility="{Binding SelectedThread, Converter={StaticResource NullToVisibilityConverter}}"/> :TODO: Figure out visibility converter.  -->
			<Border x:Name="divider"
			        Grid.Row="0"
			        Grid.RowSpan="4"
			        Grid.Column="3"
			        Width="7"
			        Padding="3">
				<Rectangle Opacity=".1"
				           Stroke="DarkGray"
				           StrokeThickness="1" />
			</Border>
			<Grid x:Name="chattyListGroup"
			      Grid.Row="1"
			      Grid.RowSpan="4"
			      Grid.Column="4"
			      MinWidth="320">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>
				<Grid Grid.Row="0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition />
						<ColumnDefinition />
					</Grid.ColumnDefinitions>
					<StackPanel Grid.Column="0"
					            VerticalAlignment="Center"
					            Orientation="Horizontal">
						<ToggleButton x:Name="newRootPostButton"
						              AutomationProperties.HelpText="New Root Post"
						              Style="{StaticResource CommentInlineButtonStyle}" />
						<ComboBox x:Name="filterCombo"
						          Margin="12,0,0,0"
						          SelectedIndex="0"
						          SelectionChanged="FilterChanged">
							<ComboBox.Items>
								<ComboBoxItem>all</ComboBoxItem>
								<ComboBoxItem>participated</ComboBoxItem>
								<ComboBoxItem>has replies</ComboBoxItem>
								<ComboBoxItem>new</ComboBoxItem>
							</ComboBox.Items>
						</ComboBox>
					</StackPanel>
					<StackPanel x:Name="chattyAppBar"
					            Grid.Column="1"
					            HorizontalAlignment="Stretch"
					            FlowDirection="RightToLeft"
					            Orientation="Horizontal">
						<Button x:Name="sortThreadsButton"
						        AutomationProperties.HelpText="Sort Threads"
						        Click="ReSortClicked"
						        IsEnabled="{Binding Source={StaticResource CoreServices},
						                            Path=Instance.UnsortedChattyPosts}"
						        Style="{StaticResource SortInlineButtonStyle}" />
						<Button AutomationProperties.HelpText="Mark All Read"
						        Click="MarkAllRead"
						        Style="{StaticResource ReadInlineButtonStyle}" />
					</StackPanel>
				</Grid>
				<ProgressBar x:Name="fullRefreshProgress"
				             Grid.Row="1"
				             VerticalAlignment="Top"
				             IsIndeterminate="True"
				             Visibility="{Binding Path=IsFullUpdateHappening,
				                                  Converter={StaticResource BoolToVisConverter}}" />
				<ListView x:Name="chattyCommentList"
				          Grid.Row="1"
				          Margin="6,0,0,0"
				          ItemTemplate="{StaticResource ChattyCommentThreadItemTemplate}"
				          ItemsSource="{Binding Source={StaticResource chattyCommentsViewSource}}"
				          SelectedValue="{Binding SelectedThread,
				                                  Mode=TwoWay}"
				          VirtualizingStackPanel.VirtualizationMode="Recycling" />
				<!--<ListView Grid.Row="1">
					<ListView.Items>
						<ListViewItem>Item 1</ListViewItem>
						<ListViewItem>Item 2</ListViewItem>
						<ListViewItem>Item 3</ListViewItem>
						<ListViewItem>Item 4</ListViewItem>
					</ListView.Items>
				</ListView>-->
				<TextBlock x:Name="lastUpdateTime"
				           Grid.Row="3"
				           Margin="6,6,0,6"
				           Style="{StaticResource BaselineTextStyle}"
				           Text="{Binding UpdateStatus}" />
			</Grid>
		</Grid>
	</Grid>

</views:ShellView>
