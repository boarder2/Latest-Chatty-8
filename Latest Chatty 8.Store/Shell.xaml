<Page x:Class="Latest_Chatty_8.Shell"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="using:Latest_Chatty_8.Controls"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      mc:Ignorable="d">

	<Page.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="ms-appx:///Styles/SplitViewStyles.xaml" />
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</Page.Resources>
	<Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>
			<Popup x:Name="LinkPopup"
			       HorizontalOffset="54"
			       VerticalOffset="4">
				<Border Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
				        BorderBrush="White"
				        BorderThickness="2"
				        Tapped="OpenClipboardLinkTapped">
					<StackPanel Orientation="Horizontal">
						<StackPanel Orientation="Vertical">
							<TextBlock Margin="4">
								Chatty link detected in clipboard.
								<LineBreak />
								Tap to open thread.
							</TextBlock>
						</StackPanel>
						<Button VerticalAlignment="Stretch"
						        Background="Red"
						        BorderThickness="0"
						        Click="CloseClipboardLinkPopupButtonClicked"
						        Content=""
						        Style="{StaticResource InlineButton}" />
					</StackPanel>
				</Border>
			</Popup>
			<Grid Grid.Row="0">
				<Grid.Background>
					<SolidColorBrush Color="{x:Bind Path=Settings.Theme.AccentBackgroundColor, Mode=OneWay}" />
				</Grid.Background>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal">
					<ToggleButton x:Name="BurguerToggle"
					              Margin="4"
					              Background="Transparent"
					              IsChecked="False"
					              ToolTipService.ToolTip="Toggle Sidebar">
						<FontIcon FontFamily="Segoe MDL2 Assets"
						          Glyph="" />
					</ToggleButton>
					<TextBlock Margin="6,0,0,0"
					           VerticalAlignment="Center"
					           FontSize="{ThemeResource ControlContentThemeFontSize}"
					           Text="{x:Bind Path=CurrentViewName, Mode=OneWay}" />
				</StackPanel>
				<Button Grid.Column="0"
				        x:Name="ConnectionIndicatorButton"
				        HorizontalAlignment="Right"
				        Content="&#xE783;"
				        Style="{StaticResource InlineButton}"
				        Visibility="{x:Bind Path=ConnectionStatus.IsConnected, Converter={StaticResource NotBoolToVisConverter}, Mode=OneWay}">
					<Button.Flyout>
						<Flyout>
							<Flyout.FlyoutPresenterStyle>
								<Style TargetType="FlyoutPresenter">
									<Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled" />
									<Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
								</Style>
							</Flyout.FlyoutPresenterStyle>

							<TextBlock Text="{x:Bind Path=ConnectionStatus.MessageDetails, Mode=OneWay}" TextWrapping="Wrap" />
						</Flyout>
					</Button.Flyout>
				</Button>
			</Grid>
			<SplitView x:Name="Splitter"
			           Grid.Row="1"
			           DisplayMode="CompactOverlay"
			           IsPaneOpen="{Binding IsChecked,
			                                ElementName=BurguerToggle,
			                                Mode=TwoWay}"
			           OpenPaneLength="320"
			           PanePlacement="Left">
				<SplitView.PaneBackground>
					<SolidColorBrush Color="{x:Bind Path=Settings.Theme.AccentBackgroundColor, Mode=OneWay}" />
				</SplitView.PaneBackground>
				<SplitView.Pane>
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="*" />
							<RowDefinition Height="Auto" />
						</Grid.RowDefinitions>
						<StackPanel Grid.Row="0">
							<Grid>
								<RadioButton x:Name="ChattyRadio"
								             Click="ClickedNav"
								             Content="Chatty"
								             GroupName="NavGroup"
								             Style="{StaticResource SplitViewRadioButtonStyle}"
								             ToolTipService.ToolTip="Chatty">
									<RadioButton.Tag>
										<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
									</RadioButton.Tag>
								</RadioButton>
							</Grid>
							<Grid Visibility="{x:Bind Path=AuthManager.LoggedIn, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}">
								<TextBlock Text="{x:Bind Path=MessageManager.UnreadCount, Mode=OneWay}" Visibility="{x:Bind Path=MessageManager.UnreadCount, Converter={StaticResource GreaterThanZeroVisibilityConverter}, Mode=OneWay}" />

								<RadioButton x:Name="MessagesRadio"
								             Click="ClickedNav"
								             Content="Messages"
								             GroupName="NavGroup"
								             Style="{StaticResource SplitViewRadioButtonStyle}"
								             ToolTipService.ToolTip="Messages">
									<RadioButton.Tag>
										<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
									</RadioButton.Tag>
								</RadioButton>
							</Grid>
							<!--<Grid Visibility="{x:Bind Path=AuthManager.LoggedIn, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}">
								<RadioButton x:Name="tagRadio"
								             Click="ClickedNav"
								             Content="Tags"
								             GroupName="NavGroup"
								             Style="{StaticResource SplitViewRadioButtonStyle}"
								             ToolTipService.ToolTip="Tags">
									<RadioButton.Tag>
										<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
									</RadioButton.Tag>
								</RadioButton>
							</Grid>-->
						</StackPanel>
						<StackPanel Grid.Row="1">
							<RadioButton x:Name="DeveloperRadio"
							             VerticalAlignment="Bottom"
							             Click="ClickedNav"
							             Content="Developer"
							             GroupName="NavGroup"
							             IsEnabled="False"
							             Style="{StaticResource SplitViewRadioButtonStyle}"
							             ToolTipService.ToolTip="Developer Tools"
							             Visibility="Collapsed">
								<RadioButton.Tag>
									<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
								</RadioButton.Tag>
							</RadioButton>
							<RadioButton x:Name="HelpRadio"
							             VerticalAlignment="Bottom"
							             Click="ClickedNav"
							             Content="Help"
							             GroupName="NavGroup"
							             Style="{StaticResource SplitViewRadioButtonStyle}"
							             ToolTipService.ToolTip="Help/About">
								<RadioButton.Tag>
									<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
								</RadioButton.Tag>
							</RadioButton>
							<RadioButton x:Name="SettingsRadio"
							             VerticalAlignment="Bottom"
							             Click="ClickedNav"
							             Content="Settings"
							             GroupName="NavGroup"
							             Style="{StaticResource SplitViewRadioButtonStyle}"
							             ToolTipService.ToolTip="Settings">
								<RadioButton.Tag>
									<TextBlock Style="{StaticResource SplitViewTextBlockStyle}" Text="" />
								</RadioButton.Tag>
							</RadioButton>
						</StackPanel>
					</Grid>
				</SplitView.Pane>
			</SplitView>
			<Grid x:Name="EmbeddedViewer"
			      Grid.Row="0"
			      Grid.RowSpan="2"
			      x:DeferLoadStrategy="Lazy"
			      Visibility="Collapsed">
				<Grid.Resources>
					<!--<Storyboard x:Name="embeddedViewerStoryboard" Completed="Animation_Completed">
						-->
					<!--<DoubleAnimation x:Name="ui_animBackgroundAnimation"
						                 Duration="0:0:0.3"
						                 From="0"
						                 Storyboard.TargetName="ui_background"
						                 Storyboard.TargetProperty="Opacity"
						                 To="1">
							<DoubleAnimation.EasingFunction>
								<QuinticEase EasingMode="EaseOut" />
							</DoubleAnimation.EasingFunction>
						</DoubleAnimation>
						<DoubleAnimation x:Name="ui_animContentRootAnimation"
						                 BeginTime="0:0:0.3"
						                 Duration="0:0:0.3"
						                 From="0"
						                 Storyboard.TargetName="ui_mainHolder"
						                 Storyboard.TargetProperty="Opacity"
						                 To="1">
							<DoubleAnimation.EasingFunction>
								<QuinticEase EasingMode="EaseOut" />
							</DoubleAnimation.EasingFunction>
						</DoubleAnimation>
						<DoubleAnimation x:Name="ui_animContentRootScaleXAnimation"
						                 BeginTime="0:0:0.3"
						                 Duration="0:0:0.3"
						                 From="0"
						                 Storyboard.TargetName="ui_mainHolderTransform"
						                 Storyboard.TargetProperty="ScaleX"
						                 To="1">
							<DoubleAnimation.EasingFunction>
								<QuinticEase x:Name="ui_easeContentRootScaleX" />
							</DoubleAnimation.EasingFunction>
						</DoubleAnimation>
						<DoubleAnimation x:Name="ui_animContentRootScaleYAnimation"
						                 BeginTime="0:0:0.3"
						                 Duration="0:0:0.3"
						                 From="0"
						                 Storyboard.TargetName="ui_mainHolderTransform"
						                 Storyboard.TargetProperty="ScaleY"
						                 To="1">
							<DoubleAnimation.EasingFunction>
								<QuinticEase x:Name="ui_easeContentRootScaleY" />
							</DoubleAnimation.EasingFunction>
						</DoubleAnimation>-->
					<!--
					</Storyboard>-->
				</Grid.Resources>
				<Grid.RowDefinitions>
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<Rectangle Grid.Row="0"
				           Grid.RowSpan="2"
				           Fill="Black"
				           Opacity=".75" />
				<Grid x:Name="EmbeddedBrowserContainer"
				      Grid.Row="0"
				      Margin="8,8,8,0" />
				<ProgressRing x:Name="BrowserLoadingIndicator"
				              Grid.Row="0"
				              Margin="16,16,0,0"
				              HorizontalAlignment="Left"
				              VerticalAlignment="Top"
				              Visibility="Collapsed" />
				<StackPanel Grid.Row="1"
				            HorizontalAlignment="Center"
				            Orientation="Horizontal">
					<Button Click="EmbeddedBrowserClicked"
					        Content=""
					        Style="{StaticResource InlineButton}"
					        ToolTipService.ToolTip="Open in Browser" />
					<Button Click="EmbeddedCloseClicked"
					        Content=""
					        Style="{StaticResource InlineButton}"
					        ToolTipService.ToolTip="Close" />
				</StackPanel>
			</Grid>
			<!-- ReSharper disable once UnusedMember.Local -->
			<Grid x:Name="MessageContainer"
				  Grid.Row="0"
			      Grid.RowSpan="2"
			      HorizontalAlignment="Center"
			      VerticalAlignment="Bottom"
			      x:DeferLoadStrategy="Lazy">
				<controls:PopupMessage x:Name="PopupMessage" />
			</Grid>
		</Grid>
		<VisualStateManager.VisualStateGroups>
			<VisualStateGroup>
				<VisualState x:Name="VisualStatePhone">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="0" />
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="Splitter.DisplayMode" Value="Overlay" />
						<Setter Target="UpdateFlyout.MaxWidth" Value="320" />
					</VisualState.Setters>
				</VisualState>
				<VisualState x:Name="VisualStateMid">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="600" />
					</VisualState.StateTriggers>
					<VisualState.Setters>
						<Setter Target="Splitter.DisplayMode" Value="Overlay" />
					</VisualState.Setters>
				</VisualState>
				<VisualState x:Name="VisualStateBig">
					<VisualState.StateTriggers>
						<AdaptiveTrigger MinWindowWidth="800" />
					</VisualState.StateTriggers>
				</VisualState>
			</VisualStateGroup>
		</VisualStateManager.VisualStateGroups>
	</Grid>
</Page>
